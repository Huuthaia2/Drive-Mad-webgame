!function(t,e,i){i.un,i.uns;var n=i.static,r=i.class,s=i.getset,h=(i.__newvec,laya.utils.Browser),l=laya.utils.ClassUtils,a=(laya.resource.Context,laya.events.Event,laya.display.Graphics,laya.utils.HTMLChar),o=laya.utils.Handler,u=laya.net.Loader,c=laya.utils.Pool,d=laya.maths.Rectangle,_=laya.display.Sprite,y=laya.display.Text,f=laya.resource.Texture,p=laya.net.URL,L=laya.utils.Utils;i.interface("laya.html.utils.ILayout");var T=function(){function HTMLHitRect(){this.rec=new d,this.reset()}r(HTMLHitRect,"laya.html.dom.HTMLHitRect");var t=HTMLHitRect.prototype;return t.reset=function(){return this.rec.reset(),this.href=null,this},t.recover=function(){c.recover("HTMLHitRect",this.reset())},HTMLHitRect.create=function(){return c.getItemByClass("HTMLHitRect",HTMLHitRect)},HTMLHitRect}(),g=function(){function LayoutLine(){this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0,this.elements=new Array}return r(LayoutLine,"laya.html.utils.LayoutLine"),LayoutLine.prototype.updatePos=function(t,e,i,n,r,s,h){var l,a=0;this.elements.length>0&&(a=(l=this.elements[this.elements.length-1]).x+l.width-this.elements[0].x),h=h||this.h;var o=0,u=NaN;"center"===r&&(o=(e-a)/2),"right"===r&&(o=e-a);for(var c=0,d=this.elements.length;c<d;c++){var _=(l=this.elements[c])._getCSSStyle();switch(0!==o&&(l.x+=o),_.valign){case"top":l.y=n;break;case"middle":var y=0;99999!=this.minTextHeight&&(y=this.minTextHeight);var f=(y+h)/2;f=Math.max(f,this.h),u=(laya.html.dom.HTMLImageElement,n+f-l.height),l.y=u;break;case"bottom":l.y=n+(h-l.height)}}},LayoutLine}(),m=function(){function HTMLDocument(){this.all=new Array,this.styleSheets=M.styleSheets}r(HTMLDocument,"laya.html.dom.HTMLDocument");var t=HTMLDocument.prototype;return t.getElementById=function(t){return this.all[t]},t.setElementById=function(t,e){this.all[t]=e},n(HTMLDocument,["document",function(){return this.document=new HTMLDocument}]),HTMLDocument}(),H=function(){function Layout(){}return r(Layout,"laya.html.utils.Layout"),Layout.later=function(t){null==Layout._will&&(Layout._will=[],i.stage.frameLoop(1,null,function(){if(!(Layout._will.length<1)){for(var t=0;t<Layout._will.length;t++)laya.html.utils.Layout.layout(Layout._will[t]);Layout._will.length=0}})),Layout._will.push(t)},Layout.layout=function(t){return t&&t._style?0==(512&t._style._type)?null:(t.style._type&=-513,Layout._multiLineLayout(t)):null},Layout._multiLineLayout=function(t){var e=new Array;t._addChildsToLayout(e);var i,n,r,s,h,l=0,a=e.length,o=t._getCSSStyle(),u=o.letterSpacing,c=o.leading,d=o.lineHeight,_=o._widthAuto()||!o.wordWrap,y=_?999999:t.width,f=(t.height,0),p=o.italic?o.fontSize/3:0,L=o.align,T=o.valign,m="top"!==T||"left"!==L||0!=d,H=0,M=0,S=0,x=0,v=new Array,E=v[0]=new g,w=!1,I=!1;E.h=0,o.italic&&(y-=o.fontSize/3);var C=0,b=!0;function addLine(){E.y=M,M+=E.h+c,E.mWidth=C,C=0,E=new g,v.push(E),E.h=0,H=0,b=!0,w=!1}for(l=0;l<a;l++)if(null!=(i=e[l]))if(b=!1,i instanceof laya.html.dom.HTMLBrElement)addLine(),E.y=M,E.h=d;else{if(i._isChar()){if((s=i).isWord)w=I||"\n"===s.char,E.wordStartIndex=E.elements.length;else{if(v.length>0&&H+S>y&&E.wordStartIndex>0){var P;P=E.elements.length-E.wordStartIndex+1,E.elements.length=E.wordStartIndex,l-=P,addLine();continue}w=!1,C+=s.width}S=s.width+s.style.letterSpacing,x=s.height,I=!1,(w=w||H+S>y)&&addLine(),E.minTextHeight=Math.min(E.minTextHeight,i.height)}else n=i._getCSSStyle(),h=i,r=n.padding,w=I||n.getLineElement(),S=h.width+r[1]+r[3]+n.letterSpacing,x=h.height+r[0]+r[2],I=n.getLineElement(),(w=w||H+S>y&&n.wordWrap)&&addLine();E.elements.push(i),E.h=Math.max(E.h,x),i.x=H,i.y=M,H+=S,E.w=H-u,E.y=M,f=Math.max(H+p,f)}else b||(H+=Layout.DIV_ELEMENT_PADDING),E.wordStartIndex=E.elements.length;if(M=E.y+E.h,m){var R=0,D=y;for(_&&t.width>0&&(D=t.width),l=0,a=v.length;l<a;l++)v[l].updatePos(0,D,l,R,L,T,d),R+=Math.max(d,v[l].h+c);M=R}return _&&(t.width=f),M>t.height&&(t.height=M),[f,M]},Layout.DIV_ELEMENT_PADDING=0,Layout._will=null,Layout}(),M=(function(){function HTMLBrElement(){}r(HTMLBrElement,"laya.html.dom.HTMLBrElement");var t=HTMLBrElement.prototype;t._addToLayout=function(t){t.push(this)},t.reset=function(){return this},t.destroy=function(){c.recover(x.getClassName(this),this.reset())},t._setParent=function(t){},t._getCSSStyle=function(){return HTMLBrElement.brStyle||(HTMLBrElement.brStyle=new M,HTMLBrElement.brStyle.setLineElement(!0),HTMLBrElement.brStyle.block=!0),HTMLBrElement.brStyle},t.renderSelfToGraphic=function(t,e,i,n){},s(0,t,"URI",null,function(t){}),s(0,t,"parent",null,function(t){}),s(0,t,"href",null,function(t){}),HTMLBrElement.brStyle=null}(),function(){function HTMLStyle(){this.padding=HTMLStyle._PADDING,this.reset()}r(HTMLStyle,"laya.html.utils.HTMLStyle");var t=HTMLStyle.prototype;return t._getExtendStyle=function(){return this._extendStyle===S.EMPTY&&(this._extendStyle=S.create()),this._extendStyle},t.reset=function(){return this.ower=null,this._type=0,this.wordWrap=!0,this.fontSize=y.defaultFontSize,this.family=y.defaultFont,this.color="#000000",this.valign="top",this.padding=HTMLStyle._PADDING,this.bold=!1,this.italic=!1,this.align="left",this.textDecoration=null,this.bgColor=null,this.borderColor=null,this._extendStyle&&this._extendStyle.recover(),this._extendStyle=S.EMPTY,this},t.recover=function(){c.recover("HTMLStyle",this.reset())},t.inherit=function(t){var e,i,n,r=0;for(e=(i=HTMLStyle._inheritProps).length,r=0;r<e;r++)this[n=i[r]]=t[n]},t._widthAuto=function(){return 0!=(262144&this._type)},t.widthed=function(t){return 0!=(8&this._type)},t._calculation=function(t,e){return!1},t.heighted=function(t){return 0!=(8192&this._type)},t.size=function(t,e){var i=this.ower,n=!1;-1!==t&&t!=i.width&&(this._type|=8,i.width=t,n=!0),-1!==e&&e!=i.height&&(this._type|=8192,i.height=e,n=!0),n&&i._layoutLater()},t.getLineElement=function(){return 0!=(65536&this._type)},t.setLineElement=function(t){t?this._type|=65536:this._type&=-65537},t._enableLayout=function(){return 0==(2&this._type)&&0==(4&this._type)},t.cssText=function(t){this.attrs(HTMLStyle.parseOneCSS(t,";"))},t.attrs=function(t){if(t)for(var e=0,i=t.length;e<i;e++){var n=t[e];this[n[0]]=n[1]}},s(0,t,"font",function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(h.onIPhone&&y.fontFamilyMap[this.family]||this.family)},function(t){for(var e=t.split(" "),i=0,n=e.length;i<n;i++){var r=e[i];switch(r){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}r.indexOf("px")>0&&(this.fontSize=parseInt(r),this.family=e[i+1],i++)}}),s(0,t,"href",function(){return this._extendStyle.href},function(t){t!==this._extendStyle.href&&(this._getExtendStyle().href=t)}),s(0,t,"lineHeight",function(){return this._extendStyle.lineHeight},function(t){this._extendStyle.lineHeight!==t&&(this._getExtendStyle().lineHeight=t)}),s(0,t,"strokeColor",function(){return this._extendStyle.strokeColor},function(t){this._extendStyle.strokeColor!==t&&(this._getExtendStyle().strokeColor=t)}),s(0,t,"stroke",function(){return this._extendStyle.stroke},function(t){this._extendStyle.stroke!==t&&(this._getExtendStyle().stroke=t)}),s(0,t,"leading",function(){return this._extendStyle.leading},function(t){this._extendStyle.leading!==t&&(this._getExtendStyle().leading=t)}),s(0,t,"align",function(){var t=48&this._type;return HTMLStyle.align_Value[t]},function(t){t in HTMLStyle.alignVDic&&(this._type&=-49,this._type|=HTMLStyle.alignVDic[t])}),s(0,t,"valign",function(){var t=192&this._type;return HTMLStyle.vAlign_Value[t]},function(t){t in HTMLStyle.alignVDic&&(this._type&=-193,this._type|=HTMLStyle.alignVDic[t])}),s(0,t,"block",function(){return 0!=(1&this._type)},function(t){t?this._type|=1:this._type&=-2}),s(0,t,"wordWrap",function(){return 0==(131072&this._type)},function(t){t?this._type&=-131073:this._type|=131072}),s(0,t,"bold",function(){return 0!=(1024&this._type)},function(t){t?this._type|=1024:this._type&=-1025}),s(0,t,"italic",function(){return 0!=(2048&this._type)},function(t){t?this._type|=2048:this._type&=-2049}),s(0,t,"whiteSpace",function(){return 131072&this._type?"nowrap":""},function(t){"nowrap"===t&&(this._type|=131072),"none"===t&&(this._type&=-131073)}),s(0,t,"width",null,function(t){if(this._type|=8,"string"==typeof t){var e=t.indexOf("auto");if(e>=0&&(this._type|=262144,t=t.substr(0,e)),this._calculation("width",t))return;t=parseInt(t)}this.size(t,-1)}),s(0,t,"height",null,function(t){if(this._type|=8192,"string"==typeof t){if(this._calculation("height",t))return;t=parseInt(t)}this.size(-1,t)}),s(0,t,"letterSpacing",function(){return this._extendStyle.letterSpacing},function(t){"string"==typeof t&&(t=parseInt(t+"")),t!=this._extendStyle.letterSpacing&&(this._getExtendStyle().letterSpacing=t)}),s(0,t,"position",function(){return 4&this._type?"absolute":""},function(t){"absolute"===t?this._type|=4:this._type&=-5}),s(0,t,"absolute",function(){return 0!=(4&this._type)}),s(0,t,"paddingLeft",function(){return this.padding[3]}),s(0,t,"paddingTop",function(){return this.padding[0]}),HTMLStyle.create=function(){return c.getItemByClass("HTMLStyle",HTMLStyle)},HTMLStyle.parseOneCSS=function(t,e){for(var i,n=[],r=t.split(e),s=0,h=r.length;s<h;s++){var l=r[s],a=l.indexOf(":"),o=l.substr(0,a).replace(/^\s+|\s+$/g,"");if(0!==o.length){var u=l.substr(a+1).replace(/^\s+|\s+$/g,""),c=[o,u];switch(o){case"italic":case"bold":c[1]="true"==u;break;case"font-weight":"bold"==u&&(c[1]=!0,c[0]="bold");break;case"line-height":c[0]="lineHeight",c[1]=parseInt(u);break;case"font-size":c[0]="fontSize",c[1]=parseInt(u);break;case"stroke":c[0]="stroke",c[1]=parseInt(u);break;case"padding":(i=u.split(" ")).length>1||(i[1]=i[2]=i[3]=i[0]),c[1]=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3])];break;default:(c[0]=HTMLStyle._CSSTOVALUE[o])||(c[0]=o)}n.push(c)}}return n},HTMLStyle.parseCSS=function(t,e){for(var i;null!=(i=HTMLStyle._parseCSSRegExp.exec(t));)HTMLStyle.styleSheets[i[1]]=HTMLStyle.parseOneCSS(i[2],";")},HTMLStyle._CSSTOVALUE={"letter-spacing":"letterSpacing","white-space":"whiteSpace","line-height":"lineHeight","font-family":"family","vertical-align":"valign","text-decoration":"textDecoration","background-color":"bgColor","border-color":"borderColor"},HTMLStyle._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),HTMLStyle.ALIGN_LEFT="left",HTMLStyle.ALIGN_CENTER="center",HTMLStyle.ALIGN_RIGHT="right",HTMLStyle.VALIGN_TOP="top",HTMLStyle.VALIGN_MIDDLE="middle",HTMLStyle.VALIGN_BOTTOM="bottom",HTMLStyle.styleSheets={},HTMLStyle.ADDLAYOUTED=512,HTMLStyle._PADDING=[0,0,0,0],HTMLStyle._HEIGHT_SET=8192,HTMLStyle._LINE_ELEMENT=65536,HTMLStyle._NOWARP=131072,HTMLStyle._WIDTHAUTO=262144,HTMLStyle._BOLD=1024,HTMLStyle._ITALIC=2048,HTMLStyle._CSS_BLOCK=1,HTMLStyle._DISPLAY_NONE=2,HTMLStyle._ABSOLUTE=4,HTMLStyle._WIDTH_SET=8,HTMLStyle._ALIGN=48,HTMLStyle._VALIGN=192,n(HTMLStyle,["_inheritProps",function(){return this._inheritProps=["italic","align","valign","leading","stroke","strokeColor","bold","fontSize","lineHeight","wordWrap","color"]},"alignVDic",function(){return this.alignVDic={left:0,center:16,right:32,top:0,middle:64,bottom:128}},"align_Value",function(){return this.align_Value={0:"left",16:"center",32:"right"}},"vAlign_Value",function(){return this.vAlign_Value={0:"top",64:"middle",128:"bottom"}}]),HTMLStyle}()),S=function(){function HTMLExtendStyle(){this.reset()}r(HTMLExtendStyle,"laya.html.utils.HTMLExtendStyle");var t=HTMLExtendStyle.prototype;return t.reset=function(){return this.stroke=0,this.strokeColor="#000000",this.leading=0,this.lineHeight=0,this.letterSpacing=0,this.href=null,this},t.recover=function(){this!=HTMLExtendStyle.EMPTY&&c.recover("HTMLExtendStyle",this.reset())},HTMLExtendStyle.create=function(){return c.getItemByClass("HTMLExtendStyle",HTMLExtendStyle)},HTMLExtendStyle.EMPTY=new HTMLExtendStyle,HTMLExtendStyle}(),x=function(){function HTMLElement(){this._creates(),this.reset()}r(HTMLElement,"laya.html.dom.HTMLElement");var t=HTMLElement.prototype;return t._creates=function(){this._style=M.create()},t.reset=function(){if(this.URI=null,this.parent=null,this._style.reset(),this._style.ower=this,this._style.valign="middle",this._text&&this._text.words){var t,e,i=this._text.words,n=0;for(t=i.length,n=0;n<t;n++)(e=i[n])&&e.recover()}return this._text=HTMLElement._EMPTYTEXT,this._children&&(this._children.length=0),this._x=this._y=this._width=this._height=0,this},t._getCSSStyle=function(){return this._style},t._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&(!this._children||0==this._children.length))return!1;if(e)for(var i=0,n=e.length;i<n;i++)t.push(e[i]);return this._children&&this._children.forEach(function(e,i,n){var r=e._style;r._enableLayout&&r._enableLayout()&&e._addToLayout(t)}),!0},t._addToLayout=function(t){if(this._style){var e=this._style;e.absolute||(e.block?t.push(this):this._addChildsToLayout(t)&&(this.x=this.y=0))}},t.repaint=function(t){void 0===t&&(t=!1),this.parentRepaint(t)},t.parentRepaint=function(t){void 0===t&&(t=!1),this.parent&&this.parent.repaint(t)},t._setParent=function(t){if(t instanceof laya.html.dom.HTMLElement){var e=t;this.URI||(this.URI=e.URI),this.style&&this.style.inherit(e.style)}},t.appendChild=function(t){return this.addChild(t)},t.addChild=function(t){return t.parent&&t.parent.removeChild(t),this._children||(this._children=[]),this._children.push(t),t.parent=this,t._setParent(this),this.repaint(),t},t.removeChild=function(t){if(!this._children)return null;var e,i=0;for(e=this._children.length,i=0;i<e;i++)if(this._children[i]==t)return this._children.splice(i,1),t;return null},t.destroy=function(){this._children&&(this.destroyChildren(),this._children.length=0),c.recover(HTMLElement.getClassName(this),this.reset())},t.destroyChildren=function(){if(this._children){for(var t=this._children.length-1;t>-1;t--)this._children[t].destroy();this._children.length=0}},t._getWords=function(){if(!this._text)return null;var t=this._text.text;if(!t||0===t.length)return null;var e,i=this._text.words;if(i&&i.length===t.length)return i;null===i&&(this._text.words=i=[]),i.length=t.length;for(var n=this.style,r=n.font,s=0,h=t.length;s<h;s++)e=L.measureText(t.charAt(s),r),i[s]=a.create().setData(t.charAt(s),e.width,e.height||n.fontSize,n);return i},t._isChar=function(){return!1},t._layoutLater=function(){var t=this.style;512&t._type||(t.widthed(this)&&(this._children&&this._children.length>0||null!=this._getWords())&&t.block?(H.later(this),t._type|=512):this.parent&&this.parent._layoutLater())},t._setAttributes=function(t,e){switch(t){case"style":this.style.cssText(e);break;case"class":this.className=e;break;case"x":this.x=parseFloat(e);break;case"y":this.y=parseFloat(e);break;case"width":this.width=parseFloat(e);break;case"height":this.height=parseFloat(e);break;default:this[t]=e}},t.formatURL=function(t){return this.URI?HTMLElement.formatURL1(t,this.URI?this.URI.path:null):t},t.drawToGraphic=function(t,e,i,n){e+=this.x,i+=this.y;var r=this.style;r.paddingLeft&&(e+=r.paddingLeft),r.paddingTop&&(i+=r.paddingTop),(null!=r.bgColor||r.borderColor)&&t.drawRect(e,i,this.width,this.height,r.bgColor,r.borderColor,1),this.renderSelfToGraphic(t,e,i,n);var s,h=0,l=0;if(this._children&&this._children.length>0)for(l=this._children.length,h=0;h<l;h++)null!=(s=this._children[h]).drawToGraphic&&s.drawToGraphic(t,e,i,n)},t.renderSelfToGraphic=function(t,e,i,n){var r=this.style,s=this._getWords();if(s&&(s.length,r)){var h=r.font,l=r.color;if(r.stroke){var a=r.stroke;a=parseInt(a);var o=r.strokeColor;t.fillBorderWords(s,e,i,h,l,o,a)}else t.fillWords(s,e,i,h,l);if(this.href){var u=s[s.length-1],c=u.y+u.height;if(u.y==s[0].y){"none"!=r.textDecoration&&t.drawLine(s[0].x,c,u.x+u.width,c,l,1);var d=T.create();d.rec.setTo(s[0].x,u.y,u.x+u.width-s[0].x,u.height),d.href=this.href,n.push(d)}else this.workLines(s,t,n)}}},t.workLines=function(t,e,i){var n;n="none"!=this.style.textDecoration;var r,s,h,l=0;if(r=t.length,h=s=t[l],s){var a;for(l=1;l<r;l++)(a=t[l]).y!=s.y?(this.createOneLine(s,h,n,e,i),s=a,h=a):h=a;this.createOneLine(s,h,n,e,i)}},t.createOneLine=function(t,e,i,n,r){var s=e.y+e.height;i&&n.drawLine(t.x,s,e.x+e.width,s,this.color,1);var h=T.create();h.rec.setTo(t.x,e.y,e.x+e.width-t.x,e.height),h.href=this.href,r.push(h)},s(0,t,"href",function(){return this._style?this._style.href:null},function(t){this._style&&t!=this._style.href&&(this._style.href=t,this.repaint())}),s(0,t,"color",null,function(t){this.style.color=t}),s(0,t,"id",null,function(t){m.document.setElementById(t,this)}),s(0,t,"innerTEXT",function(){return this._text.text},function(t){this._text===HTMLElement._EMPTYTEXT?this._text={text:t,words:null}:(this._text.text=t,this._text.words&&(this._text.words.length=0)),this.repaint()}),s(0,t,"style",function(){return this._style}),s(0,t,"width",function(){return this._width},function(t){this._width!==t&&(this._width=t,this.repaint())}),s(0,t,"x",function(){return this._x},function(t){this._x!=t&&(this._x=t,this.parentRepaint())}),s(0,t,"y",function(){return this._y},function(t){this._y!=t&&(this._y=t,this.parentRepaint())}),s(0,t,"height",function(){return this._height},function(t){this._height!==t&&(this._height=t,this.repaint())}),s(0,t,"className",null,function(t){this.style.attrs(m.document.styleSheets["."+t])}),HTMLElement.formatURL1=function(t,e){if(!t)return"null path";if(e||(e=p.basePath),t.indexOf(":")>0)return t;if(null!=p.customFormat&&(t=p.customFormat(t)),t.indexOf(":")>0)return t;var i=t.charAt(0);if("."===i)return p._formatRelativePath(e+t);if("~"===i)return p.rootPath+t.substring(1);if("d"===i){if(0===t.indexOf("data:image"))return t}else if("/"===i)return t;return e+t},HTMLElement.getClassName=function(t){return"function"==typeof t?t.name:t.constructor.name},HTMLElement._EMPTYTEXT={text:null,words:null},HTMLElement}(),v=function(){function HTMLParse(){}return r(HTMLParse,"laya.html.utils.HTMLParse"),HTMLParse.getInstance=function(t){var e=c.getItem(HTMLParse._htmlClassMapShort[t]);return e||(e=l.getInstance(t)),e},HTMLParse.parse=function(t,e,i){e=(e="<root>"+(e=e.replace(/<br>/g,"<br/>"))+"</root>").replace(HTMLParse.spacePattern,HTMLParse.char255);var n=L.parseXMLFromString(e);HTMLParse._parseXML(t,n.childNodes[0].childNodes,i)},HTMLParse._parseXML=function(t,e,i,n){var r=0,s=0;if(e.join||e.item)for(r=0,s=e.length;r<s;++r)HTMLParse._parseXML(t,e[r],i,n);else{var h,l,a;if(3==e.nodeType)return void(t instanceof laya.html.dom.HTMLDivParser?(null==e.nodeName&&(e.nodeName="#text"),l=e.nodeName.toLowerCase(),(a=e.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(h=HTMLParse.getInstance(l))&&(t.addChild(h),h.innerTEXT=a.replace(HTMLParse.char255AndOneSpacePattern," "))):(a=e.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(t.innerTEXT=a.replace(HTMLParse.char255AndOneSpacePattern," ")));if("#comment"==(l=e.nodeName.toLowerCase()))return;if(h=HTMLParse.getInstance(l)){"p"==l?(t.addChild(HTMLParse.getInstance("br")),h=t.addChild(h),t.addChild(HTMLParse.getInstance("br"))):h=t.addChild(h),h.URI=i,h.href=n;var o=e.attributes;if(o&&o.length>0)for(r=0,s=o.length;r<s;++r){var u=o[r],c=u.nodeName,d=u.value;h._setAttributes(c,d)}HTMLParse._parseXML(h,e.childNodes,i,h.href)}else HTMLParse._parseXML(t,e.childNodes,i,n)}},HTMLParse.char255=String.fromCharCode(255),HTMLParse.spacePattern=/&nbsp;|&#160;/g,HTMLParse.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),HTMLParse._htmlClassMapShort={div:"HTMLDivParser",p:"HTMLElement",img:"HTMLImageElement",span:"HTMLElement",br:"HTMLBrElement",style:"HTMLStyleElement",font:"HTMLElement",a:"HTMLElement","#text":"HTMLElement",link:"HTMLLinkElement"},HTMLParse}(),E=(function(t){function HTMLImageElement(){HTMLImageElement.__super.call(this)}r(HTMLImageElement,"laya.html.dom.HTMLImageElement",t);var e=HTMLImageElement.prototype;e.reset=function(){return t.prototype.reset.call(this),this._tex&&this._tex.off("loaded",this,this.onloaded),this._tex=null,this._url=null,this},e.onloaded=function(){if(this._style){var t=this._style;t.widthed(this)||this._tex.width,t.heighted(this)||this._tex.height;t.widthed(this)||this._width==this._tex.width||(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),t.heighted(this)||this._height==this._tex.height||(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),this.repaint()}},e._addToLayout=function(t){!this._style.absolute&&t.push(this)},e.renderSelfToGraphic=function(t,e,i,n){this._tex&&t.drawImage(this._tex,e,i,this.width||this._tex.width,this.height||this._tex.height)},s(0,e,"src",null,function(t){if(t=this.formatURL(t),this._url!==t){this._url=t;var e=this._tex=u.getRes(t);e||(this._tex=e=new f,e.load(t),u.cacheRes(t,e)),e.getIsReady()?this.onloaded():e.once("ready",this,this.onloaded)}})}(x),function(t){function HTMLDivParser(){this.contextHeight=NaN,this.contextWidth=NaN,this._htmlBounds=null,this._boundsRec=null,this.repaintHandler=null,HTMLDivParser.__super.call(this)}r(HTMLDivParser,"laya.html.dom.HTMLDivParser",t);var e=HTMLDivParser.prototype;return e.reset=function(){return t.prototype.reset.call(this),this._style.block=!0,this._style.setLineElement(!0),this._style.width=200,this._style.height=200,this.repaintHandler=null,this.contextHeight=0,this.contextWidth=0,this},e.appendHTML=function(t){v.parse(this,t,this.URI),this.layout()},e._addChildsToLayout=function(t){var e=this._getWords();if(null==e&&(!this._children||0==this._children.length))return!1;e&&e.forEach(function(e){t.push(e)});for(var i=!0,n=0,r=this._children.length;n<r;n++){var s=this._children[n];i?i=!1:t.push(null),s._addToLayout(t)}return!0},e._addToLayout=function(t){this.layout(),!this.style.absolute&&t.push(this)},e.getBounds=function(){return this._htmlBounds?(this._boundsRec||(this._boundsRec=d.create()),this._boundsRec.copyFrom(this._htmlBounds)):null},e.parentRepaint=function(e){void 0===e&&(e=!1),t.prototype.parentRepaint.call(this),this.repaintHandler&&this.repaintHandler.runWith(e)},e.layout=function(){this.style._type|=512;var t=H.layout(this);if(t){this._htmlBounds||(this._htmlBounds=d.create());var e=this._htmlBounds;e.x=e.y=0,e.width=this.contextWidth=t[0],e.height=this.contextHeight=t[1]}},s(0,e,"height",function(){return this._height?this._height:this.contextHeight},t.prototype._$set_height),s(0,e,"innerHTML",null,function(t){this.destroyChildren(),this.appendHTML(t)}),s(0,e,"width",function(){return this._width?this._width:this.contextWidth},function(t){var e=!1;e=0===t?t!=this._width:t!=this.width,i.superSet(x,this,"width",t),e&&this.layout()}),HTMLDivParser}(x)),w=(function(t){function HTMLLinkElement(){HTMLLinkElement.__super.call(this)}r(HTMLLinkElement,"laya.html.dom.HTMLLinkElement",t);var e=HTMLLinkElement.prototype;e._creates=function(){},e.drawToGraphic=function(t,e,i,n){},e.reset=function(){return this._loader&&this._loader.off("complete",this,this._onload),this._loader=null,this},e._onload=function(t){switch(this._loader&&(this._loader=null),this.type){case"text/css":M.parseCSS(t,this.URI)}this.repaint(!0)},s(0,e,"href",t.prototype._$get_href,function(t){t&&(t=this.formatURL(t),this.URI=new p(t),this._loader&&this._loader.off("complete",this,this._onload),u.getRes(t)?"text/css"==this.type&&M.parseCSS(u.getRes(t),this.URI):(this._loader=new u,this._loader.once("complete",this,this._onload),this._loader.load(t,"text")))}),HTMLLinkElement._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g")}(x),function(t){function HTMLStyleElement(){HTMLStyleElement.__super.call(this)}r(HTMLStyleElement,"laya.html.dom.HTMLStyleElement",t);var e=HTMLStyleElement.prototype;e._creates=function(){},e.drawToGraphic=function(t,e,i,n){},e.reset=function(){return this},s(0,e,"innerTEXT",t.prototype._$get_innerTEXT,function(t){M.parseCSS(t,null)})}(x),function(t){function HTMLDivElement(){this._element=null,this._recList=[],this._innerHTML=null,this._repaintState=0,HTMLDivElement.__super.call(this),this._element=new E,this._element.repaintHandler=new o(this,this._htmlDivRepaint),this.mouseEnabled=!0,this.on("click",this,this._onMouseClick)}r(HTMLDivElement,"laya.html.dom.HTMLDivElement",t);var e=HTMLDivElement.prototype;return e.destroy=function(e){void 0===e&&(e=!0),this._element&&this._element.reset(),this._element=null,this._doClears(),t.prototype.destroy.call(this,e)},e._htmlDivRepaint=function(t){void 0===t&&(t=!1),t?this._repaintState<2&&(this._repaintState=2):this._repaintState<1&&(this._repaintState=1),this._repaintState>0&&this._setGraphicDirty()},e._updateGraphicWork=function(){switch(this._repaintState){case 1:this._updateGraphic();break;case 2:this._refresh()}},e._setGraphicDirty=function(){this.callLater(this._updateGraphicWork)},e._doClears=function(){if(this._recList){var t=0,e=this._recList.length;for(t=0;t<e;t++)this._recList[t].recover();this._recList.length=0}},e._updateGraphic=function(){this._doClears(),this.graphics.clear(!0),this._repaintState=0,this._element.drawToGraphic(this.graphics,-this._element.x,-this._element.y,this._recList);var t=this._element.getBounds();t&&this.setSelfBounds(t),this.size(t.width,t.height)},e._refresh=function(){this._repaintState=1,this._innerHTML&&(this._element.innerHTML=this._innerHTML),this._setGraphicDirty()},e._onMouseClick=function(){var t,e,i=this.mouseX,n=this.mouseY,r=0;for(t=this._recList.length,r=0;r<t;r++)(e=this._recList[r]).rec.contains(i,n)&&this._eventLink(e.href)},e._eventLink=function(t){this.event("link",[t])},s(0,e,"style",function(){return this._element.style}),s(0,e,"innerHTML",null,function(t){this._innerHTML!=t&&(this._repaintState=1,this._innerHTML=t,this._element.innerHTML=t,this._setGraphicDirty())}),s(0,e,"contextWidth",function(){return this._element.contextWidth}),s(0,e,"contextHeight",function(){return this._element.contextHeight}),HTMLDivElement}(_));!function(t){function HTMLIframeElement(){HTMLIframeElement.__super.call(this),this._element._getCSSStyle().valign="middle"}r(HTMLIframeElement,"laya.html.dom.HTMLIframeElement",w);var e=HTMLIframeElement.prototype;s(0,e,"href",null,function(t){var e=this;t=this._element.formatURL(t);var i=new u;i.once("complete",null,function(i){var n=e._element.URI;e._element.URI=new p(t),e.innerHTML=i,!n||(e._element.URI=n)}),i.load(t,"text")})}()}(window,document,Laya);